$(document).ready(function(){"use strict";function a(a,b){return Math.random()*(b-a)+a}function b(c,d,e){if(d<c.length){i.val(c.substring(0,d+1));var f=a(20,130);d++,setTimeout(function(){b(c,d,e)},f)}else d===c.length&&($(".cli-control").before('<p class="success"><span class="dollar">$</span> '+i.val()+"</p>"),i.val(""),e++,c=$(".text-"+e).data("text"),c&&b(c,0,e))}function c(){$(".cli-body > p").remove(),$(".cli-body > ul").remove(),$(".cli-body > br").remove(),$(".cli-body").prepend("<p>Last login: "+k+" on ttys000\n</p>")}function d(){console.log("soon")}function e(){function a(){b.game.init()}$(".cli-body p").addClass("hidden"),$(".cli-body").prepend("<p class=\"game-instructions\">Type 'quit' to quit.</p>");var b={};b.equalCoordinates=function(a,b){return a[0]===b[0]&&a[1]===b[1]},b.checkCoordinateInArray=function(a,c){var d=!1;return $.each(c,function(c,e){b.equalCoordinates(a,e)&&(d=!0)}),d},b.game=function(){function a(){a=$("#jsSnake"),0===a.length&&$(".cli-body").append('<canvas id="jsSnake">');var a=$("canvas");a.attr("width",b.width),a.attr("height",b.height),j=a[0],k=j.getContext("2d"),k.fillStyle="black",o=0,l=100,m=b.snake(),n=b.apple(),i(),c()}function c(){k.clearRect(0,0,b.width,b.height),m.advance(n),d(),m.checkCollision()?(m.retreat(),m.draw(k),f()):p=setTimeout(c,l)}function d(){m.draw(k),g(),n.draw(k),e()}function e(){k.save(),k.font="bold 102px sans-serif",k.fillStyle="rgba(0, 0, 0, 0.3)",k.textAlign="center",k.textBaseline="middle";var a=b.width/2,c=b.width/2;k.fillText(o.toString(),a,c),k.restore()}function f(){k.save(),k.font="bold 30px sans-serif",k.fillStyle="#000",k.textAlign="center",k.textBaseline="middle",k.strokeStyle="white",k.lineWidth=2;var a=b.width/2,c=b.width/2;k.strokeText("Game Over",a,c-10),k.fillText("Game Over",a,c-10),k.font="bold 15px sans-serif",k.strokeText("Press space to restart",a,c+15),k.fillText("Press space to restart",a,c+15),k.restore()}function g(){k.save(),k.strokeStyle="#FFF",k.lineWidth=b.blockSize,k.lineCap="square";var a=k.lineWidth/2,c=[[a,a],[b.width-a,a],[b.width-a,b.height-a],[a,b.height-a]];k.beginPath(),k.moveTo.apply(k,c[3]),$.each(c,function(a,b){k.lineTo.apply(k,b)}),k.stroke(),k.restore()}function h(){clearTimeout(p),$("body").unbind("keydown"),$(b).unbind("appleEaten"),$(j).unbind("click"),b.game.init()}function i(){$(document).keydown(function(a){switch(a.which){case 37:m.setDirection("left"),a.preventDefault();break;case 38:m.setDirection("up"),a.preventDefault();break;case 39:m.setDirection("right"),a.preventDefault();break;case 40:m.setDirection("down"),a.preventDefault();break;case 32:h()}}),$(b).bind("appleEaten",function(a,b){n.setNewPosition(b),o++,l*=.99}),$(j).click(h)}var j,k,l,m,n,o,p;return b.width=200,b.height=200,b.blockSize=10,b.widthInBlocks=b.width/b.blockSize,b.heightInBlocks=b.height/b.blockSize,{init:a}}(),b.apple=function(){function a(a){a.save(),a.fillStyle="#FFF",a.beginPath();var c=b.blockSize/2,d=g[0]*b.blockSize+c,e=g[1]*b.blockSize+c;a.arc(d,e,c,0,2*Math.PI,!0),a.fill(),a.restore()}function c(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function d(){var a=c(1,b.widthInBlocks-2),d=c(1,b.heightInBlocks-2);return[a,d]}function e(a){var c=d();return b.checkCoordinateInArray(c,a)?e(a):void(g=c)}function f(){return g}var g=[6,6];return{draw:a,setNewPosition:e,getPosition:f}},b.snake=function(){function a(a){var b;switch(k){case"left":case"right":b=["up","down"];break;case"up":case"down":b=["left","right"];break;default:throw"Invalid direction"}b.indexOf(a)>-1&&(l=a)}function c(a,c){a.save(),a.fillStyle="#FFF";var d=b.blockSize*c[0],e=b.blockSize*c[1];a.fillRect(d,e,b.blockSize,b.blockSize),a.restore()}function d(a){for(var b=0;b<j.length;b++)c(a,j[b])}function e(){var a=!1,c=!1,d=j[0],e=j.slice(1),f=d[0],g=d[1],h=1,i=1,k=b.widthInBlocks-1,l=b.heightInBlocks-1,m=h>f||f>=k,n=i>g||g>=l;return(m||n)&&(a=!0),c=b.checkCoordinateInArray(d,e),a||c}function f(a){var c=j[0].slice();switch(k=l){case"left":c[0]-=1;break;case"up":c[1]-=1;break;case"right":c[0]+=1;break;case"down":c[1]+=1;break;default:throw"Invalid direction"}i=j.slice(),j.unshift(c),g(j[0],a)?$(b).trigger("appleEaten",[j]):j.pop()}function g(a,c){return b.equalCoordinates(a,c.getPosition())}function h(){j=i}var i,j=[];j.push([6,4]),j.push([5,4]);var k,l=k="right";return{draw:d,advance:f,retreat:h,setDirection:a,checkCollision:e}},a()}function f(){var a=document.getElementById("jsSnake");a&&($(".game-instructions").remove(),a.remove(),$(".cli-body p").removeClass("hidden"))}function g(){$(".cli-control").before('<p class="success"><span class="dollar">$</span> '+i.val()+'</p><p>GNU bash, version beep.boop-release (x86_64-apple-macintosh^2)<br>These shell commands are defined internally.<br>Type \'help\' to see this list.</p><br><ul class="commands"><li>ls</li><li>cd</li><li>clear</li><li>snake</li></ul><ul class="command-descriptions"><li>list subdirectories</li><li>change directory</li><li>remove previous console entries</li><li>play snake</li></ul>'),i.val("")}function h(){o=i.val();var a=!1,b=o.split(" "),c=b[0];b.shift();for(var d=0;d<p.length;d++)if(c===p[d].name){p[d]["function"](b),a=!0,j.scrollTop=j.scrollHeight;break}a||($(".cli-control").before('<p class="error"><span class="dollar">$</span> '+i.val()+"</p> \n<p>~bash: "+o+": command not found</p>"),i.val(""),j.scrollTop=j.scrollHeight),m.push(o),n=m.length,o=""}var i=$(".cli-input"),j=document.getElementById("cli-body");$(".cli-body").click(function(){i.focus()}),i.on("change",function(){$(".cli-control").before('<p class="success"><span class="dollar">$</span> '+i.val()+"</p>"),i.val("")});var k=(new Date).toString();k=k.substr(0,k.indexOf("GMT")-1),$(".cli-body").prepend("<p>Last login: "+k+" on ttys000\n</p>");var l=$(".text-0").data("text");b(l,0,0);var m=[],n=0,o="",p=[{name:"clear","function":c,description:"remove previous console entries"},{name:"ls","function":d,description:"list directories"},{name:"help","function":g,description:"list help commands"},{name:"snake","function":e,description:"play snake game"},{name:"quit","function":f,description:"end currently running program"}];$(document).keypress(function(a){a=a||window.event;var b="number"==typeof a.which?a.which:a.keyCode;switch(b){case 13:h()}})});